"use strict";
var Observable_1 = require("rxjs/Observable");
var WebSocketService = (function () {
    function WebSocketService() {
    }
    WebSocketService.prototype.connect = function (url, input) {
        return new Observable_1.Observable(function (observer) {
            var socket = new WebSocket(url);
            var inputSubscription;
            socket.onopen = function () {
                inputSubscription = input.subscribe(function (data) {
                    socket.send(JSON.stringify(data));
                });
            };
            socket.onmessage = function (message) {
                observer.next(JSON.parse(message.data));
            };
            socket.onerror = function (error) {
                observer.error(error);
            };
            socket.onclose = function () {
                observer.complete();
            };
            return function () {
                if (inputSubscription)
                    inputSubscription.unsubscribe();
                if (socket)
                    socket.close();
            };
        });
    };
    return WebSocketService;
}());
exports.WebSocketService = WebSocketService;
//# sourceMappingURL=index.service.js.map